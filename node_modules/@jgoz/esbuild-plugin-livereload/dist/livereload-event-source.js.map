{
  "version": 3,
  "sources": ["../src/event-source.ts"],
  "sourcesContent": ["import type { ClientMessage } from './livereload-plugin';\n\ndeclare global {\n  interface Window {\n    __ESBUILD_LR_PLUGIN__: string;\n  }\n}\n\nfunction writeWarnings(result: ClientMessage | undefined) {\n  if (!result?.warnings) return;\n  for (const warning of result.warnings) {\n    if (!warning.location) {\n      console.warn(`WARN: ${warning.text}`);\n    } else {\n      const { file, line, column } = warning.location;\n      const pluginText = warning.pluginName ? `[plugin: ${warning.pluginName}] ` : '';\n      console.warn(`WARN: ${file}:${line}:${column}: warning: ${pluginText}${warning.text}`);\n    }\n  }\n}\n\nasync function init() {\n  const { overlay } = await import('@jgoz/esbuild-overlay');\n\n  const evt = new EventSource(window.__ESBUILD_LR_PLUGIN__ + 'esbuild');\n  let removeOverlay: (() => void) | undefined;\n\n  evt.addEventListener('change', e => {\n    const msg: ClientMessage = JSON.parse(e?.data ?? '{}');\n    writeWarnings(msg);\n\n    const { forceReload = false, added, removed, updated } = msg;\n\n    if (forceReload || added.length || removed.length || updated.length > 1) {\n      console.log('esbuild-plugin-livereload: reloading...');\n      location.reload();\n      return;\n    }\n\n    if (updated.length === 1) {\n      for (const link of Array.from(document.getElementsByTagName('link'))) {\n        const url = new URL(link.href);\n\n        if (url.host === location.host && url.pathname === msg.updated[0]) {\n          console.log(`esbuild-plugin-livereload: reloading CSS file ${msg.updated[0]}...`);\n\n          const next = link.cloneNode() as HTMLLinkElement;\n          next.href = msg.updated[0] + '?' + Math.random().toString(36).slice(2);\n          next.onload = () => link.remove();\n          link.parentNode!.insertBefore(next, link.nextSibling);\n          return;\n        }\n      }\n      console.log('esbuild-plugin-livereload: reloading...');\n      location.reload();\n    }\n\n    if (removeOverlay && !msg.errors?.length) {\n      removeOverlay();\n      removeOverlay = undefined;\n    }\n\n    if (msg.errors?.length) {\n      removeOverlay = overlay({\n        errors: msg.errors.slice(),\n        openFileURL: window.__ESBUILD_LR_PLUGIN__ + 'esbuild/open-editor',\n      });\n    }\n  });\n}\n\ninit().catch(e => {\n  console.error('ERROR: Unable to initialize esbuild-plugin-livereload');\n  console.error(e.toString());\n});\n"],
  "mappings": ";AAQA,SAAS,cAAc,QAAmC;AACxD,MAAI,CAAC,QAAQ,SAAU;AACvB,aAAW,WAAW,OAAO,UAAU;AACrC,QAAI,CAAC,QAAQ,UAAU;AACrB,cAAQ,KAAK,SAAS,QAAQ,IAAI,EAAE;AAAA,IACtC,OAAO;AACL,YAAM,EAAE,MAAM,MAAM,OAAO,IAAI,QAAQ;AACvC,YAAM,aAAa,QAAQ,aAAa,YAAY,QAAQ,UAAU,OAAO;AAC7E,cAAQ,KAAK,SAAS,IAAI,IAAI,IAAI,IAAI,MAAM,cAAc,UAAU,GAAG,QAAQ,IAAI,EAAE;AAAA,IACvF;AAAA,EACF;AACF;AAEA,eAAe,OAAO;AACpB,QAAM,EAAE,QAAQ,IAAI,MAAM,OAAO,uBAAuB;AAExD,QAAM,MAAM,IAAI,YAAY,OAAO,wBAAwB,SAAS;AACpE,MAAI;AAEJ,MAAI,iBAAiB,UAAU,OAAK;AAClC,UAAM,MAAqB,KAAK,MAAM,GAAG,QAAQ,IAAI;AACrD,kBAAc,GAAG;AAEjB,UAAM,EAAE,cAAc,OAAO,OAAO,SAAS,QAAQ,IAAI;AAEzD,QAAI,eAAe,MAAM,UAAU,QAAQ,UAAU,QAAQ,SAAS,GAAG;AACvE,cAAQ,IAAI,yCAAyC;AACrD,eAAS,OAAO;AAChB;AAAA,IACF;AAEA,QAAI,QAAQ,WAAW,GAAG;AACxB,iBAAW,QAAQ,MAAM,KAAK,SAAS,qBAAqB,MAAM,CAAC,GAAG;AACpE,cAAM,MAAM,IAAI,IAAI,KAAK,IAAI;AAE7B,YAAI,IAAI,SAAS,SAAS,QAAQ,IAAI,aAAa,IAAI,QAAQ,CAAC,GAAG;AACjE,kBAAQ,IAAI,iDAAiD,IAAI,QAAQ,CAAC,CAAC,KAAK;AAEhF,gBAAM,OAAO,KAAK,UAAU;AAC5B,eAAK,OAAO,IAAI,QAAQ,CAAC,IAAI,MAAM,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,CAAC;AACrE,eAAK,SAAS,MAAM,KAAK,OAAO;AAChC,eAAK,WAAY,aAAa,MAAM,KAAK,WAAW;AACpD;AAAA,QACF;AAAA,MACF;AACA,cAAQ,IAAI,yCAAyC;AACrD,eAAS,OAAO;AAAA,IAClB;AAEA,QAAI,iBAAiB,CAAC,IAAI,QAAQ,QAAQ;AACxC,oBAAc;AACd,sBAAgB;AAAA,IAClB;AAEA,QAAI,IAAI,QAAQ,QAAQ;AACtB,sBAAgB,QAAQ;AAAA,QACtB,QAAQ,IAAI,OAAO,MAAM;AAAA,QACzB,aAAa,OAAO,wBAAwB;AAAA,MAC9C,CAAC;AAAA,IACH;AAAA,EACF,CAAC;AACH;AAEA,KAAK,EAAE,MAAM,OAAK;AAChB,UAAQ,MAAM,uDAAuD;AACrE,UAAQ,MAAM,EAAE,SAAS,CAAC;AAC5B,CAAC;",
  "names": []
}
